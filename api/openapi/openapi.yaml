openapi: 3.0.3
info:
  title: Family App API
  version: 0.1.0
  description: API for family-app backend.
servers:
  - url: http://localhost:8080
paths:
  /health:
    get:
      summary: Healthcheck
      responses:
        '200':
          description: OK
          content:
            text/plain:
              schema:
                type: string
  /auth/me:
    get:
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthMeResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /sync:
    post:
      summary: Sync offline operations
      description: |
        Applies offline operations in request order.
        Idempotency is supported by `operation_id` (per operation) and optional `Idempotency-Key` (per batch request).
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: Idempotency-Key
          required: false
          schema:
            type: string
            minLength: 8
            maxLength: 128
          description: |
            Optional key for replaying the same full batch.
            Reusing the same key with a different payload returns `409`.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncBatchRequest'
      responses:
        '200':
          description: Batch processed (success, partial success, or all failed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncBatchResponse'
        '400':
          $ref: '#/components/responses/InvalidRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/FamilyNotFound'
        '409':
          $ref: '#/components/responses/IdempotencyConflict'
        '413':
          $ref: '#/components/responses/SyncBatchTooLarge'
  /analytics/summary:
    get:
      summary: Analytics summary
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: currency
          schema:
            type: string
        - in: query
          name: tag_ids
          schema:
            type: string
        - in: query
          name: timezone
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsSummary'
  /analytics/timeseries:
    get:
      summary: Analytics timeseries
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: group_by
          required: true
          schema:
            type: string
            enum: [day, week, month]
        - in: query
          name: currency
          schema:
            type: string
        - in: query
          name: tag_ids
          schema:
            type: string
        - in: query
          name: timezone
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AnalyticsTimeseriesPoint'
  /analytics/by-tag:
    get:
      summary: Analytics by tag
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: currency
          schema:
            type: string
        - in: query
          name: tag_ids
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AnalyticsByTagRow'
  /reports/monthly:
    get:
      summary: Monthly report
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from_month
          required: true
          schema:
            type: string
        - in: query
          name: to_month
          required: true
          schema:
            type: string
        - in: query
          name: currency
          schema:
            type: string
        - in: query
          name: tag_ids
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReportsMonthlyRow'
  /reports/compare:
    get:
      summary: Compare two periods
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from_a
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to_a
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: from_b
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: to_b
          required: true
          schema:
            type: string
            format: date
        - in: query
          name: currency
          schema:
            type: string
        - in: query
          name: tag_ids
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportsCompareResponse'
  /families/me:
    get:
      summary: Get current family
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Family'
        '404':
          $ref: '#/components/responses/FamilyNotFound'
    patch:
      summary: Update family name
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFamilyRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Family'
  /families:
    post:
      summary: Create family
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFamilyRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Family'
        '409':
          $ref: '#/components/responses/AlreadyInFamily'
  /families/join:
    post:
      summary: Join family by code
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinFamilyRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Family'
        '404':
          $ref: '#/components/responses/FamilyCodeNotFound'
        '409':
          $ref: '#/components/responses/AlreadyInFamily'
  /families/leave:
    post:
      summary: Leave family
      security:
        - bearerAuth: []
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/FamilyNotFound'
  /families/me/members:
    get:
      summary: List family members
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FamilyMember'
  /families/me/members/{user_id}:
    delete:
      summary: Remove family member
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '403':
          $ref: '#/components/responses/NotOwner'
        '404':
          $ref: '#/components/responses/MemberNotFound'
        '409':
          $ref: '#/components/responses/CannotRemoveOwner'
  /expenses:
    get:
      summary: List expenses
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: tag_id
          schema:
            type: string
          description: Single tag id filter. Ignored if tag_ids is provided.
        - in: query
          name: tag_ids
          schema:
            type: string
          description: Comma-separated list of tag ids. Matches expenses with any of the tags.
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseList'
    post:
      summary: Create expense
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExpenseRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Expense'
  /expenses/{id}:
    put:
      summary: Update expense
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExpenseRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Expense'
    delete:
      summary: Delete expense
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
  /tags:
    get:
      summary: List tags
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tag'
    post:
      summary: Create tag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTagRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
  /tags/{id}:
    patch:
      summary: Update tag
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTagRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '404':
          $ref: '#/components/responses/TagNotFound'
        '409':
          $ref: '#/components/responses/TagNameTaken'
    delete:
      summary: Delete tag
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/TagNotFound'
        '409':
          $ref: '#/components/responses/TagInUse'
  /todo-lists:
    get:
      summary: List todo lists
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
        - in: query
          name: include_items
          schema:
            type: boolean
            default: false
        - in: query
          name: items_archived
          schema:
            type: string
            enum: [exclude, only, all]
            default: exclude
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoListList'
    post:
      summary: Create todo list
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTodoListRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoList'
  /todo-lists/{list_id}:
    patch:
      summary: Update todo list
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: list_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTodoListRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoList'
        '404':
          $ref: '#/components/responses/TodoListNotFound'
    delete:
      summary: Delete todo list
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: list_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/TodoListNotFound'
  /todo-lists/{list_id}/items:
    get:
      summary: List todo items
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: list_id
          required: true
          schema:
            type: string
        - in: query
          name: archived
          schema:
            type: string
            enum: [exclude, only, all]
            default: exclude
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoItemList'
        '404':
          $ref: '#/components/responses/TodoListNotFound'
    post:
      summary: Create todo item
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: list_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTodoItemRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoItem'
        '404':
          $ref: '#/components/responses/TodoListNotFound'
  /todo-items/{item_id}:
    patch:
      summary: Update todo item
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: item_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTodoItemRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoItem'
        '404':
          $ref: '#/components/responses/TodoItemNotFound'
    delete:
      summary: Delete todo item
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: item_id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/TodoItemNotFound'
  /gym/entries:
    get:
      summary: List gym entries
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: limit
          schema:
            type: integer
            default: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymEntryList'
    post:
      summary: Create gym entry
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGymEntryRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymEntry'
  /gym/entries/{id}:
    put:
      summary: Update gym entry
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGymEntryRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GymEntry'
        '404':
          $ref: '#/components/responses/GymEntryNotFound'
    delete:
      summary: Delete gym entry
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/GymEntryNotFound'
  /gym/workouts:
    get:
      summary: List workouts
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: limit
          schema:
            type: integer
            default: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkoutList'
    post:
      summary: Create workout
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkoutRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workout'
  /gym/workouts/{id}:
    get:
      summary: Get workout
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workout'
        '404':
          $ref: '#/components/responses/WorkoutNotFound'
    put:
      summary: Update workout
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkoutRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workout'
        '404':
          $ref: '#/components/responses/WorkoutNotFound'
    delete:
      summary: Delete workout
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/WorkoutNotFound'
  /gym/templates:
    get:
      summary: List templates
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateList'
    post:
      summary: Create template
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'
  /gym/templates/{id}:
    put:
      summary: Update template
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'
        '404':
          $ref: '#/components/responses/TemplateNotFound'
    delete:
      summary: Delete template
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/TemplateNotFound'
  /gym/exercises:
    get:
      summary: List exercises
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExerciseList'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    InvalidRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: invalid_request
              message: Invalid request
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: invalid_token
              message: Invalid token
    IdempotencyConflict:
      description: Idempotency key was already used with another payload
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: idempotency_key_payload_mismatch
              message: Idempotency-Key was already used with different payload
    SyncBatchTooLarge:
      description: Too many operations in one sync request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: sync_batch_too_large
              message: Too many operations in one batch
    FamilyNotFound:
      description: Family not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: family_not_found
              message: Family not found
    FamilyCodeNotFound:
      description: Family code not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: family_code_not_found
              message: Family code not found
    AlreadyInFamily:
      description: Already in family
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: already_in_family
              message: Already in family
    NotOwner:
      description: Not owner
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: not_owner
              message: Only owner can remove members
    MemberNotFound:
      description: Member not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: member_not_found
              message: Member not found
    CannotRemoveOwner:
      description: Cannot remove owner
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: cannot_remove_owner
              message: Cannot remove owner
    TodoListNotFound:
      description: Todo list not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: todo_list_not_found
              message: Todo list not found
    TodoItemNotFound:
      description: Todo item not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: todo_item_not_found
              message: Todo item not found
    TagNotFound:
      description: Tag not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: tag_not_found
              message: Tag not found
    TagInUse:
      description: Tag is used by expenses
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: tag_in_use
              message: Tag is used by expenses
    TagNameTaken:
      description: Tag name already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: tag_name_taken
              message: Tag name already exists
    GymEntryNotFound:
      description: Gym entry not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: gym_entry_not_found
              message: Gym entry not found
    WorkoutNotFound:
      description: Workout not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: workout_not_found
              message: Workout not found
    TemplateNotFound:
      description: Template not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: template_not_found
              message: Template not found
  schemas:
    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
            message:
              type: string
    SyncBatchRequest:
      type: object
      required: [operations]
      properties:
        client_generated_at:
          type: string
          format: date-time
          nullable: true
        operations:
          type: array
          minItems: 1
          maxItems: 100
          items:
            $ref: '#/components/schemas/SyncOperation'
    SyncOperation:
      oneOf:
        - $ref: '#/components/schemas/SyncCreateExpenseOperation'
        - $ref: '#/components/schemas/SyncCreateTodoOperation'
        - $ref: '#/components/schemas/SyncSetTodoCompletedOperation'
      discriminator:
        propertyName: type
        mapping:
          create_expense: '#/components/schemas/SyncCreateExpenseOperation'
          create_todo: '#/components/schemas/SyncCreateTodoOperation'
          set_todo_completed: '#/components/schemas/SyncSetTodoCompletedOperation'
    SyncCreateExpenseOperation:
      type: object
      required: [operation_id, type, local_id, payload]
      properties:
        operation_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [create_expense]
        local_id:
          type: string
          maxLength: 128
        payload:
          $ref: '#/components/schemas/CreateExpenseRequest'
    SyncCreateTodoOperation:
      type: object
      required: [operation_id, type, local_id, payload]
      properties:
        operation_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [create_todo]
        local_id:
          type: string
          maxLength: 128
        payload:
          $ref: '#/components/schemas/SyncCreateTodoPayload'
    SyncSetTodoCompletedOperation:
      type: object
      required: [operation_id, type, payload]
      properties:
        operation_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [set_todo_completed]
        payload:
          $ref: '#/components/schemas/SyncSetTodoCompletedPayload'
    SyncCreateTodoPayload:
      type: object
      required: [list_id, title]
      properties:
        list_id:
          type: string
        title:
          type: string
    SyncSetTodoCompletedPayload:
      type: object
      required: [is_completed]
      anyOf:
        - required: [todo_id]
        - required: [todo_local_id]
      properties:
        todo_id:
          type: string
        todo_local_id:
          type: string
        is_completed:
          type: boolean
    SyncBatchResponse:
      type: object
      required: [sync_id, status, summary, results, mappings, server_time]
      properties:
        sync_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [success, partial_success, failed]
        summary:
          $ref: '#/components/schemas/SyncBatchSummary'
        results:
          type: array
          items:
            $ref: '#/components/schemas/SyncOperationResult'
        mappings:
          type: array
          items:
            $ref: '#/components/schemas/SyncEntityMapping'
        server_time:
          type: string
          format: date-time
    SyncBatchSummary:
      type: object
      required: [total, applied, duplicate, failed]
      properties:
        total:
          type: integer
        applied:
          type: integer
        duplicate:
          type: integer
        failed:
          type: integer
    SyncOperationResult:
      type: object
      required: [operation_id, type, status]
      properties:
        operation_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [create_expense, create_todo, set_todo_completed]
        status:
          type: string
          enum: [applied, duplicate, failed]
        local_id:
          type: string
          nullable: true
        entity:
          type: string
          enum: [expense, todo_item]
          nullable: true
        server_id:
          type: string
          nullable: true
        error:
          allOf:
            - $ref: '#/components/schemas/SyncOperationError'
          nullable: true
    SyncEntityMapping:
      type: object
      required: [entity, local_id, server_id]
      properties:
        entity:
          type: string
          enum: [expense, todo_item]
        local_id:
          type: string
        server_id:
          type: string
    SyncOperationError:
      type: object
      required: [code, message, retryable]
      properties:
        code:
          $ref: '#/components/schemas/SyncErrorCode'
        message:
          type: string
        retryable:
          type: boolean
    SyncErrorCode:
      type: string
      enum:
        - invalid_request
        - invalid_json
        - unsupported_operation_type
        - operation_payload_mismatch
        - dependency_not_resolved
        - tag_not_found
        - todo_list_not_found
        - todo_item_not_found
        - family_not_found
        - sync_batch_too_large
        - idempotency_key_payload_mismatch
        - batch_in_progress
        - internal_error
    AuthMeResponse:
      type: object
      required: [id]
      properties:
        id:
          type: string
        email:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
    Family:
      type: object
      required: [id, name, code, owner_id, created_at]
      properties:
        id:
          type: string
        name:
          type: string
        code:
          type: string
        owner_id:
          type: string
        created_at:
          type: string
          format: date-time
    FamilyMember:
      type: object
      required: [user_id, role, joined_at]
      properties:
        user_id:
          type: string
        role:
          type: string
          enum: [owner, member]
        joined_at:
          type: string
          format: date-time
        email:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
    Expense:
      type: object
      required: [id, family_id, user_id, date, amount, currency, title, tag_ids, created_at, updated_at]
      properties:
        id:
          type: string
        family_id:
          type: string
        user_id:
          type: string
        date:
          type: string
          format: date
        amount:
          type: number
        currency:
          type: string
        title:
          type: string
        tag_ids:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ExpenseList:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Expense'
        total:
          type: integer
    Tag:
      type: object
      required: [id, name, created_at]
      properties:
        id:
          type: string
        name:
          type: string
        created_at:
          type: string
          format: date-time
    TodoList:
      type: object
      required: [id, family_id, title, is_collapsed, order, created_at, settings, items_total, items_completed, items_archived]
      properties:
        id:
          type: string
        family_id:
          type: string
        title:
          type: string
        is_collapsed:
          type: boolean
        order:
          type: integer
        created_at:
          type: string
          format: date-time
        settings:
          $ref: '#/components/schemas/TodoListSettings'
        items_total:
          type: integer
        items_completed:
          type: integer
        items_archived:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoItem'
    TodoListSettings:
      type: object
      required: [archive_completed]
      properties:
        archive_completed:
          type: boolean
    TodoItem:
      type: object
      required: [id, list_id, title, is_completed, is_archived, created_at]
      properties:
        id:
          type: string
        list_id:
          type: string
        title:
          type: string
        is_completed:
          type: boolean
        is_archived:
          type: boolean
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        completed_by:
          allOf:
            - $ref: '#/components/schemas/TodoCompletedBy'
          nullable: true
    TodoCompletedBy:
      type: object
      required: [id, name, email]
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        avatar_url:
          type: string
          nullable: true
    TodoListList:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoList'
        total:
          type: integer
    TodoItemList:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoItem'
        total:
          type: integer
    GymEntry:
      type: object
      required: [id, user_id, date, exercise, weight_kg, reps, created_at, updated_at]
      properties:
        id:
          type: string
        user_id:
          type: string
        date:
          type: string
          format: date
        exercise:
          type: string
        weight_kg:
          type: number
        reps:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    GymEntryList:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GymEntry'
        total:
          type: integer
    WorkoutSet:
      type: object
      required: [id, exercise, weight_kg, reps]
      properties:
        id:
          type: string
        exercise:
          type: string
        weight_kg:
          type: number
        reps:
          type: integer
    Workout:
      type: object
      required: [id, user_id, date, name, sets, created_at, updated_at]
      properties:
        id:
          type: string
        user_id:
          type: string
        date:
          type: string
          format: date
        name:
          type: string
        sets:
          type: array
          items:
            $ref: '#/components/schemas/WorkoutSet'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    WorkoutList:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Workout'
        total:
          type: integer
    TemplateExercise:
      type: object
      required: [id, name, reps, sets]
      properties:
        id:
          type: string
        name:
          type: string
        reps:
          type: integer
        sets:
          type: integer
    Template:
      type: object
      required: [id, user_id, name, exercises, created_at, updated_at]
      properties:
        id:
          type: string
        user_id:
          type: string
        name:
          type: string
        exercises:
          type: array
          items:
            $ref: '#/components/schemas/TemplateExercise'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TemplateList:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Template'
    ExerciseList:
      type: object
      required: [exercises]
      properties:
        exercises:
          type: array
          items:
            type: string
    AnalyticsSummary:
      type: object
      required: [total_amount, currency, count, avg_per_day, from, to]
      properties:
        total_amount:
          type: number
        currency:
          type: string
        count:
          type: integer
        avg_per_day:
          type: number
        from:
          type: string
          format: date
        to:
          type: string
          format: date
    AnalyticsTimeseriesPoint:
      type: object
      required: [period, total, count]
      properties:
        period:
          type: string
        total:
          type: number
        count:
          type: integer
    AnalyticsByTagRow:
      type: object
      required: [tag_id, tag_name, total, count]
      properties:
        tag_id:
          type: string
        tag_name:
          type: string
        total:
          type: number
        count:
          type: integer
    ReportsMonthlyRow:
      type: object
      required: [month, total, count]
      properties:
        month:
          type: string
        total:
          type: number
        count:
          type: integer
    ReportsCompareResponse:
      type: object
      required: [period_a, period_b, delta]
      properties:
        period_a:
          $ref: '#/components/schemas/ReportsComparePeriod'
        period_b:
          $ref: '#/components/schemas/ReportsComparePeriod'
        delta:
          $ref: '#/components/schemas/ReportsDelta'
    ReportsComparePeriod:
      type: object
      required: [from, to, total, count]
      properties:
        from:
          type: string
          format: date
        to:
          type: string
          format: date
        total:
          type: number
        count:
          type: integer
    ReportsDelta:
      type: object
      required: [amount, percent]
      properties:
        amount:
          type: number
        percent:
          type: number
    CreateFamilyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    JoinFamilyRequest:
      type: object
      required: [code]
      properties:
        code:
          type: string
    UpdateFamilyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    CreateExpenseRequest:
      type: object
      required: [date, amount, currency, title]
      properties:
        date:
          type: string
          format: date
        amount:
          type: number
        currency:
          type: string
        title:
          type: string
        tag_ids:
          type: array
          items:
            type: string
    UpdateExpenseRequest:
      type: object
      required: [date, amount, currency, title]
      properties:
        date:
          type: string
          format: date
        amount:
          type: number
        currency:
          type: string
        title:
          type: string
        tag_ids:
          type: array
          items:
            type: string
    CreateTagRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    UpdateTagRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    CreateTodoListRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
        settings:
          $ref: '#/components/schemas/TodoListSettings'
        order:
          type: integer
    UpdateTodoListRequest:
      type: object
      properties:
        title:
          type: string
        settings:
          $ref: '#/components/schemas/TodoListSettings'
        is_collapsed:
          type: boolean
        order:
          type: integer
    CreateTodoItemRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
    UpdateTodoItemRequest:
      type: object
      properties:
        title:
          type: string
        is_completed:
          type: boolean
    CreateGymEntryRequest:
      type: object
      required: [date, exercise, weight_kg, reps]
      properties:
        date:
          type: string
          format: date
        exercise:
          type: string
        weight_kg:
          type: number
        reps:
          type: integer
    UpdateGymEntryRequest:
      type: object
      required: [date, exercise, weight_kg, reps]
      properties:
        date:
          type: string
          format: date
        exercise:
          type: string
        weight_kg:
          type: number
        reps:
          type: integer
    CreateWorkoutSetRequest:
      type: object
      required: [exercise, weight_kg, reps]
      properties:
        exercise:
          type: string
        weight_kg:
          type: number
        reps:
          type: integer
    CreateWorkoutRequest:
      type: object
      required: [date, name]
      properties:
        date:
          type: string
          format: date
        name:
          type: string
        sets:
          type: array
          items:
            $ref: '#/components/schemas/CreateWorkoutSetRequest'
    UpdateWorkoutRequest:
      type: object
      required: [date, name]
      properties:
        date:
          type: string
          format: date
        name:
          type: string
        sets:
          type: array
          items:
            $ref: '#/components/schemas/CreateWorkoutSetRequest'
    CreateTemplateExerciseRequest:
      type: object
      required: [name, reps, sets]
      properties:
        name:
          type: string
        reps:
          type: integer
        sets:
          type: integer
    CreateTemplateRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        exercises:
          type: array
          items:
            $ref: '#/components/schemas/CreateTemplateExerciseRequest'
    UpdateTemplateRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        exercises:
          type: array
          items:
            $ref: '#/components/schemas/CreateTemplateExerciseRequest'
